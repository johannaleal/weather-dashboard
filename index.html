<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="./assets/css/style.css" />

    <script src="assets/js/script.js"></script>

    <title>Weather Dashboard</title>
  </head>

  <body>
    <header>
      <h1>Weather Dashboard</h1>
    </header>

    <div class="row">
      <div class="col-md-3">
        <section id="left-nav">
          <div class="card" style="width: 18rem;">
            <div class="card-header flush">
              <h4>Search for a City:</h4>
              <form class="d-flex">
                <input class="form-control me-2" id="search-city" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" id="search-button" type="submit"><i class="fas fa-search"></i></button>
              </form>
            </div>

            <div class="list-group flush">
              <a href="#" class="list-group-item list-group-item-action" aria-current="true">
                Los Angeles
              </a>
              <a href="#" class="list-group-item list-group-item-action">New York</a>
              <a href="#" class="list-group-item list-group-item-action">Paris</a>
              <a href="#" class="list-group-item list-group-item-action">London</a>
            </div>
          </div>
        </section>
      </div>

      <div class="col-md-9">

        <!-- <div class="row"> -->
          <section id="current-city">
            <div class="card">
              <h2 class="card-header" id="currentCityAndDate"></h2>

              <div class="card-body">
                <!-- <h5 class="card-title"></h5> -->
                <p class="card-text" id="cityTemp"></p>
                <p class="card-text" id="cityHumidity"></p>
                <p class="card-text" id="cityWindSpeed"></p>
                <p class="card-text"><span id="cityUV"></span><span id="uvIndex"></span></p>
              </div>
            </div>
          </section>
        
          <section id="five-days">
            <!-- <div class="row row-cols-1 row-cols-md-3 g-4">
              <div class="col">
                <div class="card">
                  <img src="..." class="card-img-top" alt="...">
                  <div class="card-body">
                    <h5 class="card-title">Card title</h5>
                    <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                  </div>
                </div>
              </div>
            </div> -->
          </section>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="assets/js/script.js"></script>

    <script>
      // Get any saved cities from local storage.
      var savedCities = JSON.parse(localStorage.getItem("savedCities"));

      // build the side menu.

       // This .on("click") function will trigger the AJAX Call
       $("#search-button").on("click", function(event) {

      // Display the current date in header.
      var todaysDate = moment().format("M/D/YY");
      var temp;
      var humidity;
      var windSpeed;
      var uvIndex;
      var weatherIcon;
      var latitude;
      var longitude;
      var uvIndexBGColor;
      var city = $("#search-city").val();

      // Capitalize first letter of city.
      city = city[0].toUpperCase() + city.substring(1).toLowerCase();
    
      // Set the API key for OpenWeather app.
      var APIKey = "d9e6975ed0304582f03c3687d8d7dc74";
      var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + APIKey;

      // Create an AJAX call.
      $.ajax({
        url: queryURL,
        method: "GET"
      }).then(function(response) {
        // Get the location of the weather icon and put it in an img tag.
        weatherIcon = " <img src=\"" + "http://openweathermap.org/img/wn/" + response.weather[0].icon + "@2x.png\">";

        // The header for the city being searched for is the city name, today's date, and the current weather icon.
        $("#currentCityAndDate").html(city + " (" + todaysDate + ")" + weatherIcon);

        // Get the temperature from the response object.
        temp = (response.main.temp).toFixed(1);
        $("#cityTemp").text("Temperature: " + temp.toString() + "\xB0F");

        // Get the humidity.
        humidity = response.main.humidity;
        $("#cityHumidity").text("Humidity: " + humidity.toString() + "%");

        // GEt the wind speed.
        windSpeed = (response.wind.speed).toFixed(1);
        $("#cityWindSpeed").text("Wind Speed: " + windSpeed.toString() + " MPH");

        // Get the longitute and latitude in order to determine the UV Index.
        longitude = response.coord.lon;
        latitude = response.coord.lat;

        // Get the UV information.
        queryURL = "https://api.openweathermap.org/data/2.5/uvi?lat=" + latitude + "&lon=" + longitude + "&appid=" + APIKey;
        $.ajax({
          url: queryURL,
          method: "GET"
        }).then(function(responseUV) {
          $("#cityUV").text("UV Index: ");

          var uvIndex = responseUV.value;

          $("#uvIndex").text(uvIndex.toString());
          $("#uvIndex").attr("style", getUVIndexColor(uvIndex));
        });

        getFiveDayForecast(city, APIKey);
      });

      function getUVIndexColor(uvIndex) {
        var style;

        if ((uvIndex >= 0) && (uvIndex <= 2)) {
          style = "color: white; background-color: green";
        }
        else if ((uvIndex >= 3) && (uvIndex <= 5)) {
          style = "color: black; background-color: yellow";
        }
        else if ((uvIndex >= 6) && (uvIndex <= 7)) {
          style = "color: black; background-color: orange";
        }
        else if ((uvIndex >= 8) && (uvIndex <= 10)) {
          style = "color: white; background-color: red";
        }
        else if (uvIndex >= 11) {
          style = "color: white; background-color: purple";
        };

        return style;
      };

      function getFiveDayForecast(city, APIKey) {
         // Get the 5 day forecast
        //var queryURL = "http://api.openweathermap.org/data/2.5/forecast?id=524901&q=" + city + "&appid=" + APIKey;

        var queryURL = "https://api.openweathermap.org/data/2.5/forecast/daily?q=" + city + "&cnt=5&units=imperial&appid=" + APIKey;

        console.log(queryURL);

        $.ajax({
          url: queryURL,
          method: "GET"
        }).then(function(response) {
          console.log(response);

          // $("#cityUV").text("UV Index: ");

          // var uvIndex = response.value;
          // console.log(uvIndex.toString());

          // $("#uvIndex").text(uvIndex.toString());
          // $("#uvIndex").attr("style", getUVIndexColor(uvIndex));

          // <div class="row row-cols-1 row-cols-md-3 g-4">
          //     <div class="col">
          //       <div class="card">
          //         <img src="..." class="card-img-top" alt="...">
          //         <div class="card-body">
          //           <h5 class="card-title">Card title</h5>
          //           <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
          //         </div>
          //       </div>
          //     </div>
          //   </div>
        });
      }
    })
    </script>
  </body>
</html>
